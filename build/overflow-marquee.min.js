/*! overflow-marquee 2016-02-24 */
"use strict";angular.module("overflow-marquee",[]).value("OverflowMarqueeValues",{overflowMarqueeClass:"overflow-marquee",parentMarqueeClass:"overflow-marquee-container",intervalDuration:25,defaultMarqueeSpeed:1,statusCodes:{STARTING:1,STARTED:100,PAUSING:0,PAUSED:-1},opacitySpeed:500,resetSpeed:400}).directive("overflowMarquee",["$timeout","$interval","$q","OverflowMarqueeValues",function(e,a,t,s){return{restrict:"A",scope:{overflowMarqueePause:"=?",overflowMarqueeSpeed:"=?",overflowMarqueeRepeat:"=?"},link:function(o,r,u){function n(){if(console.log("RESETTING?"),o.status=s.statusCodes.PAUSING,o.moved=0,a.cancel(f),0!=w.$$state.status){var u=t.defer();r.css("opacity",0);var n=e(function(){r.css("left",0),i=e(function(){r.css("opacity",1),v=e(function(){o.status=s.statusCodes.PAUSED,e.cancel(n),e.cancel(i),e.cancel(v),u.resolve()},s.resetSpeed)},s.opacitySpeed)},s.opacitySpeed);w=u.promise}return w}function l(){f&&0===f.$$state.status||(o.status=s.statusCodes.STARTING,f=a(c,s.intervalDuration))}function c(){o.status=s.statusCodes.STARTED,o.moved<o.overflowLength?(o.moved+=o.overflowMarqueeSpeed,r.css("left",parseInt(r.css("left"))-o.overflowMarqueeSpeed)):n().then(function(){o.overflowMarqueePause||l()})}r.addClass(s.overflowMarqueeClass),r.parent().addClass(s.parentMarqueeClass);var f,d,i,v,p,w=t.when(),q=e(function(){r.width()>r.parent().width()?(o.overflowMarqueeSpeed=parseInt(o.overflowMarqueeSpeed)||s.defaultMarqueeSpeed,o.overflowMarqueePause=o.overflowMarqueePause||!1,o.status=s.statusCodes.PAUSED,o.moved=0,o.overflowLength=r.width()-r.parent().width(),p=o.$watch("overflowMarqueePause",function(e){console.log("PAUSE CHANGE",e),e?n():0===w.$$state.status?w.then(l):l()})):(r.removeClass(s.titleMarqueeClass),r.parent().removeClass(s.parentMarqueeClass))});r.on("destroy",function(){p(),e.cancel(q),e.cancel(d),e.cancel(i),e.cancel(v),a.cancel(f),o.$destroy()})}}}]);